# 미션 - 크리스마스 프로모션🎅

--- 

## ✏️ 요구사항

사용자로부터 주문을 받고, 주문 내역과 방문 일자에 부합하는 할인 및 이벤트 내역을 출력하는 **크리스마스 프로모션을 구현**한다.

프로그램은 다음과 같은 방식으로 동작한다.

![](flowchart.png)

### 프로그램 실행 예시

```
안녕하세요! 우테코 식당 12월 이벤트 플래너입니다.
12월 중 식당 예상 방문 날짜는 언제인가요? (숫자만 입력해 주세요!)
3
주문하실 메뉴를 메뉴와 개수를 알려 주세요. (e.g. 해산물파스타-2,레드와인-1,초코케이크-1)
티본스테이크-1,바비큐립-1,초코케이크-2,제로콜라-1
12월 3일에 우테코 식당에서 받을 이벤트 혜택 미리 보기!
 
<주문 메뉴>
티본스테이크 1개
바비큐립 1개
초코케이크 2개
제로콜라 1개
 
<할인 전 총주문 금액>
142,000원
 
<증정 메뉴>
샴페인 1개
 
<혜택 내역>
크리스마스 디데이 할인: -1,200원
평일 할인: -4,046원
특별 할인: -1,000원
증정 이벤트: -25,000원
 
<총혜택 금액>
-31,246원
 
<할인 후 예상 결제 금액>
135,754원
 
<12월 이벤트 배지>
산타
```

### 이벤트

**총주문 금액이 10,000원 이상**인 경우에, 다음의 달력을 참고해 이벤트가 적용된다.

![](../image.png)

| 이벤트          | 기간                     | 내용                                             | 비고                                           |
|:-------------|:-----------------------|:-----------------------------------------------|:---------------------------------------------|
| 크리스마스 디데이 할인 | 2023.12.1 ~ 2023.12.25 | 1,000원으로 시작하여 크리스마스가 다가올수록 날마다 할인 금액이 100원씩 증가 | 총주문 금액에서 해당 금액만큼 할인                          ||
| 평일 할인        | 2023.12.1 ~ 2023.12.31 | 평일에는 디저트 메뉴를 메뉴 1개당 2,023원 할인                  | 평일: 일요일~목요일                                  |
| 주말 할인        | 2023.12.1 ~ 2023.12.31 | 주말에는 메인 메뉴를 메뉴 1개당 2,023원 할인                   | 주말: 금요일, 토요일                                 |
| 특별 할인        | 2023.12.1 ~ 2023.12.31 | 이벤트 달력에 별이 있으면 총주문 금액에서 1,000원 할인              | 총 6일(3, 10, 17, 24, 25, 31)                  |
| 증정 이벤트       | 2023.12.1 ~ 2023.12.31 | 할인 전 총주문 금액이 12만 원 이상일 때, 샴페인 1개 증정            | 단순 증정(할인 혜택 금액에 포함되나 실제 주문에서 차감되지는 않음)       |
| 이벤트 배지 부여    | 2023.12.1 ~ 2023.12.31 | 총혜택 금액에 따라 다른 이벤트 배지를 부여                       | 5천 원 이상: 별 <br/>1만 원 이상: 트리<br/> 2만 원 이상: 산타 |



---

## 🤗 ️프로젝트 구조

### 프로그램 디렉토리 구조

```css
main
│
└── java
└── christmas
├── benefit
│ ├── BenefitManager.java
│ ├── Discount.java
│ ├── DiscountPolicy.java
│ ├── EventBadge.java
│ └── EventCalendar.java
├── menu
│ ├── Category.java
│ ├── Menu.java
│ └── MenuBoard.java
├── order
│ └── Order.java
│ └── Orders.java
├── ui
│ ├── InputView.java
│ └── OutputView.java
└── Application.java
test
│
└── java
└── christmas
├── discount
│ └── DiscountPolicyTest.java
├── event
│ ├── EventCalendarTest.java
│ └── EventManagerTest.java
├── menu
│ └── MenuBoardTest.java
├── order
│ └── OrderTest.java
└── ApplicationTest.java

```

- benefit - 할인, 이벤트와 관련된 모든 혜택 관리
- menu - 메뉴, 메뉴판(메뉴 목록) 등 메뉴 전반 관리
- order - 모든 주문을 생성하고 관리
- ui - 입출력 관리

### 클래스 다이어그램

![image](classdiagram.png)

## 🚀 기능 목록

### 핵심 로직

구현한 기능 목록은 [프로그램 디렉토리 구조](#프로그램-디렉토리-구조)의 디렉토리별로 구분해두었다.

#### menu
| 역할         | 기능(책임)                                                                                                                                | 비고                                                                                  |
|:-----------|:--------------------------------------------------------------------------------------------------------------------------------------|:------------------------------------------------------------------------------------|
| **메뉴**     | 분류, 이름, 가격을 가진다<br/>메뉴 이름이 맞는지 확인한다                                                                                                   | 음식은 **[에피타이저, 메인, 디저트, 음료]** 로 분류된다.<br/> -> 별도의 **Category enum**으로 분리             |
| **메뉴판**    | 메뉴 목록을 가진다 <br/> 메뉴 이름으로 메뉴 클래스 존재 여부를 확인한다.<br/>메뉴의 분류, 가격을 반환한다                                                                     | 요구사항으로 주어진 메뉴는 Application에서 입력한다.                                                  |

#### order
| 역할         | 기능(책임)                                                                                                                                | 비고                                                                                  |
|:-----------|:--------------------------------------------------------------------------------------------------------------------------------------|:------------------------------------------------------------------------------------|
| **주문**     | 메뉴판과 분류, 메뉴 이름, 주문수량을 가진다<br/>주문과 주문수량을 검증해 주문을 생성한다<br/>해당 주문에 대한 금액(가격 * 주문수량)을 반환한다<br/>해당 주문의 분류를 확인한다<br/>분류, 메뉴 이름, 주문 수량을 반환한다 | 메뉴판에 존재하는 메뉴만 주문이 가능하다<br/>주문은 1~20개만 가능하다                                          |
| **주문 목록**  | 주문과 관련된 입력을 바탕으로 주문 목록을 생성한다<br/>주문 목록을 검증한다<br/>주문 개수를 반환한다<br/>메뉴 이름과 주문 수량 목록을 반환한다<br/>카테고리별 총 주문수량을 반환한다<br/>총금액을 반환한다           | 음료만 주문하는 것은 불가하다<br/>주문은 한번에 최대 20개까지만 가능하다                                         |


#### benefit
| 역할         | 기능(책임)                                                                                                                                | 비고                                               |
|:-----------|:--------------------------------------------------------------------------------------------------------------------------------------|:-------------------------------------------------|
| **이벤트 달력** | 크리스마스 기간, 특별 할인일, 주말 등 할인 기간에 대한 정보를 가진다<br/>주어진 날짜가 할인 기간에(크리스마스/특별할인/평일/주말) 해당하는 지 여부를 반환한다.                                        | 할인은 **[크리스마스, 특별, 평일, 주말, 증정]** 으로 분류된다          |
| **할인**     | 할인 자체에 대한 정보를 가진다<br/>할인 금액, 추가 할인금액(크리스마스의 경우), 할인을 위한 가격 조건을 필드로 가지며 이를 반환한다                                                        | enum 타입                                          |
| **할인 정책**  | 각 할인에 대한 할인 로직을 가진다<br/>주어진 날짜와 주문이 할인 조건에 부합하는지 여부를 확인하고 할인 금액을 반환한다                                                                 | 할인 로직은 [이벤트](#이벤트) 설명 참조                         |
| **이벤트 배지** | 이벤트 배지 자체와 해당 이벤트 배지의 획득 조건인 혜택 금액을 가진다. <br/> 이름과 혜택 금액을 반환한다                                                                        | 이벤트 배지는 **[없음, 별, 트리, 산타]** 로 분류된다.<br/> enum 타입 |
| **혜택 관리**  | 할인 정책과 이벤트를 바탕으로 할인 혜택과 이벤트 배지를 반환한다<br/> 총 주문 금액에서 총 혜택 금액을 제한 최종 결제 금액을 반환한다                                                        |                                                  |

### UI 로직

| 구분     | 책임                             | 비고                                                                                                                                                   | 에러 메시지/예시                                                                                    |
|:-------|:-------------------------------|:-----------------------------------------------------------------------------------------------------------------------------------------------------|:---------------------------------------------------------------------------------------------|
| **입력** | 방문 날짜를 입력받는다<br/>입력값을 검증한다     | 1~31 사이의 숫자만 입력 가능하다<br/> 유효하지 않은 입력시  에러 메시지를 출력한다                                                                                                  | "[ERROR] 유효하지 않은 날짜입니다. 다시 입력해 주세요."                                                                                             |
| **입력** | 주문 메뉴와 개수를 입력받는다<br/>입력값을 검증한다 | 에러 메시지를 출력하는 경우<br/>- 메뉴판에 없는 메뉴를 입력하는 경우<br/>- 주문 개수의 경우 1 이상의 숫자 이외의 입력값을 입력하는 경우<br/>- 메뉴 형식이 예시와 다른 경우<br/>- 중복 메뉴를 입력한 경우(e.g. 시저샐러드-1,시저샐러드-1) | "[ERROR] 유효하지 않은 주문입니다. 다시 입력해 주세요."                                                                                             |
| **출력** | 주문 메뉴를 출력한다                    | 출력 순서는 자유                                                                                                                                            | <주문 메뉴><br/>타파스 1개<br/>제로콜라 1개                                                               |
| **출력** | 할인 전 총주문 금액을 출력한다              |                                                                                                                                                      | <할인 전 총주문 금액> <br/>8,500원                                                                    |
| **출력** | 증정 메뉴를 출력한다                    | 증정 메뉴가 없다면 "없음"을 출력한다                                                                                                                                | <증정 메뉴> <br/>샴페인 1개                                                                          |
| **출력** | 적용된 혜택 내역을 출력한다                | 혜택 내역이 없다면 "없음"을 출력한다<br/> 여러 개의 이벤트가 적용된 경우, 출력 순서는 자유                                                                                              | <혜택 내역><br/>크리스마스 디데이 할인: -1,200원<br/>평일 할인: -4,046원<br/>특별 할인: -1,000원<br/>증정 이벤트: -25,000원 |
| **출력** | 12월 이벤트 배지 출력한다                | 혜택 내역이 없다면 "없음"을 출력한다                                                                                                                                | <12월 이벤트 배지><br/>산타                                                                          |

혜택 내역, 총혜택 금액, 할인 후 예상 결제 금액, 12월 이벤트 배지 내용

입력 부분에서 해당 조건에 부합하지 않는 잘못된 값을 입력한 경우, IllegalArgumentException이 발생한다.
에러 메시지와 함께 에러 발생 후, 해당 부분부터 다시 입력받는다.

---

## ✅ 테스트

주어진 요구사항에 따라 UI 로직을 제외한 핵심 로직에만 테스트를 구현했다.

### MenuBoard 
| 테스트 내용                     |  통과 여부 |
|:---------------------------|:--------------------------|
| 메뉴판에 존재하는 메뉴면 true/fase 반환 |  ✔️ |
| 메뉴판에 존재하는 메뉴면 카테고리 반환      |  ✔️ |
| 메뉴판에 존재하지 않는 메뉴면 예외 발생     |  ✔️ |

### Order

| 테스트 내용                          |  통과 여부 |
|:--------------------------------|:--------------------------|
| 메뉴에 없는 음식을 주문하면 예외 처리한다         |  ✔️ |
| 1개 미만으로 주문하면 예외 처리한다            |  ✔️ |
| 20개를 초과 주문하면 예외 처리한다            |  ✔️ |
| 주문한 메뉴의 가격과 주문한 수량으로 주문금액을 계산한다 |  ✔️ |

### Orders

| 테스트 내용                     | 통과 여부 |
|:---------------------------|:------|
| 총 주문가능 수량(20)을 초과하는 경우 예외 처리한다 | ✔️    | 
| 음료만 주문하는 경우 예외 처리한다 | ✔️      |
| 주문내역을 통해 총금액을 반환한다 |    ✔️   |
| 주문한 메뉴의 카테고리별 총 주문 금액을 반환한다 |    ✔️   |

### EventCalendar
| 테스트 내용                     | 통과 여부 |
|:---------------------------|:------|
| 1~25일은 크리스마스 할인 기간이다. | ✔️    |
| 25일 이후는 크리스마스 할인 기간이 아니다. | ✔️    |
| 3, 10, 17, 24, 25, 31일은 특별 할인 기간이다. | ✔️    |
| 3, 10, 17, 24, 25, 31일을 제외한 날은 특별 할인 기간이 아니다. | ✔️    |
| 1, 2, 8, 9, 15, 16, 22, 23, 29, 30일은 주말 할인 기간이다.(평일 할인 기간이 아니다) | ✔️    |
| 1, 2, 8, 9, 15, 16, 22, 23, 29, 30일은 주말 할인 기간이다.(평일 할인 기간이 아니다) | ✔️    |

### DiscountPolicy
| 비고       | 테스트 내용                     | 통과 여부 |
|:---------|:---------------------------|:------|
| 크리스마스 할인 | 크리스마스 기간에는 크리스마스 할인을 받을 수 있다 | ✔️    |
|          | 만원 미만으로 주문하면 크리스마스 할인을 받을 수 없다 | ✔️    |
|          | 크리스마스가 지나면 크리스마스 할인을 받을 수 없다 | ✔️    |
| 특별 할인    |특정 날짜에는 특별 할인을 받을 수 있다 |      ✔️  |
|          |만원 미만으로 주문하면 특별 할인을 받을 수 없다 |  ✔️      |
|          | 특정 날짜가 아니면 특별 할인을 받을 수 없다 |       ✔️ |
| 평일 할인    | 평일에 디저트를 주문하면 평일 할인을 받을 수 있다 |     ✔️   |
|          | 만원 미만으로 주문하면 평일 할인을 받을 수 없다 |      ✔️  |
| 주말 할인    | 주말에 메인을 주문하면 주말 할인을 받을 수 있다 |      ✔️  |
|          | 주말에 메인을 주문하면 주말 할인을 받을 수 있다 |     ✔️   |
| 증정       | 12만원 이상 구매시 증정 할인을 받을 수 있다 |       ✔️ |
|          | 12만원 미만 구매시 증정 할인을 받을 수 없다 |      ✔️  |


### BenefitManager

| 테스트 내용                     | 통과 여부 |
|:---------------------------|:------|
| 총혜택금액이 5천원 미만이면 배지 '없음'이다 | ✔️    |
| 총혜택금액이 5천원 이상 1만원 미만이면 배지 '별'이다 | ✔️    |
| 총혜택금액이 1만원 이상 2만원 미만이면 배지 '트리'이다 | ✔️    |
| 총혜택금액이 2만원 이상이면 배지 '산타'이다 | ✔️    |
| 주문내역과 주문일자를 입력하면 총혜택금액을 반환한다 | ✔️    |
| 주문내역과 주문일자를 입력하면 총결제금액을 반환한다 | ✔️    |

---

## 🤔 고려 사항

3주차 과제에 비해 별도의 요구사항이 추가되진 않았지만, 기존의 과제와는 달리 요구사항이 이메일 형식으로 제공되었다는 점과 프로젝트 진행 방식에 차이가 있었다.  

프로젝트를 진행하며 가장 많이 고려한 사항을 크게 세 가지로 나눠 정리해보았다.

### 객체지향적 설계

핵심 로직별로 클래스를 분리하고, 최소한의 책임을 가지도록 설계하기 위해 다음과 같은 사항들을 고민했다.

#### 책임 분산과 로직 분리

이번 과제뿐만 아니라 그동안의 과제를 수행하면서 항상 가장 어려웠던 부분인 것 같다.
프로그램에서 구현해야 할 기능들을 작은 단위로 나누어 나열해보고 공통된 도메인을 가지는 부분끼리 묶어보며 설계했으며, 
리팩토링 시에도 객체가 책임을 가지고 있는지, 한 객체에 책임이 과중되어 있지는 않는지를 위주로 살펴보며 코드를 수정했다.

예를 들어 기존의 EventCalendar는 단순히 이벤트와 관련된 날짜를 리스트나 int 타입으로 갖는 것 외에는 별도의 로직이 없었다.

```java
public class EventCalendar {
    public static final List<Integer> WEEKEND_DAY = Arrays.asList(1, 2, 8, 9, 15, 16, 22, 23, 29, 30);
    public static final List<Integer> SPECIAL_DAY = Arrays.asList(3, 10, 17, 24, 25, 31);
    public static final int CHRISTMAS_START = 1;
    public static final int CHRISTMAS_END = 25;
}
```
리팩토링 이후 DiscountPolicy에서 해당 이벤트 기간인지를 확인하는 조건 부분을 EventCalendar에서 수행할 수 있도록 로직을 추가해주었다.


```java
public boolean isChristmasPeriod(int date) {
        return (date >= CHRISTMAS_START && date <= CHRISTMAS_END);
    }

    public boolean isSpecialDay(int date) {
        return (SPECIAL_DAY.contains(date));
    }

    public boolean isWeekend(int date) {
        return (WEEKEND_DAY.contains(date));
    }

    public boolean isWeekday(int date) {
        return (!WEEKEND_DAY.contains(date));
    }
```

또한, **Menu의 Category나 price를 가져오는게 Menu 리스트를 관리하는 MenuBoard의 역할이 맞는가?** 에 대해서도 고민이 있었다.   
그러나 MenuBoard는 Menu를 추가, 관리하고 Menu의 정보를 제공하는 역할을 하므로 책임이 과중되거나 전가되었다고 판단하는 않았다.

#### 자료 구조

메뉴판이나 주문내역 등의 목록을 어떤 방식으로 설계할 것인지를 고민했다. 
특히 **메뉴와 주문을 별도로 생성해야 하는가?** 가 주된 고려 사항이었다.   

카테고리를 key로 가지고 메뉴명, 가격, 주문수량 등을 value로 가지는 방식과 별도의 Menu, Order 객체를 생성하는 방식 중에서 다음의 이유로 후자를 선택했다.

>1. 의미 전달이 모호하며 로직 작성이 복잡해질 수 있다.  
>2. 주문에 대한 검증과 주문 목록에 대한 검증이 별도로 존재하며 로직을 분리할 필요가 있다.  
>3. 추후 추가나 수정이 발생할 수 있으므로 유연성과 확장성을 고려해야 한다.  

#### 재사용성

자바와 객체지향 개념에 익숙하지 않아 요구사항으로 주어진 메뉴를 어디에서 넣어줘야 하는가? 에 대한 고민이 있었다.  
초기에는 MenuBoard 내부에 값을 추가하는 addMain,addDessert 등의 메서드로 값을 넣어주고, MenuBoard 생성자를 호출하면 자동으로 메뉴를 등록하도록 작성했다. 

```java
private void addMain() {
    menuBoard.add(Menu.of ("티본스테이크", 55_000, Categony.MAIN));
    menuBoard.add Menu.of("바베큐립", 54_000, Category.MAIN));
    menuBoard.add(Menu.of("해산물파스타", 35_000, Category.MAIN));
    menuBoard.add(Menu.of("크리스마스파스타", 25_000, Category.MAIN));
}
```

그러나 메뉴의 확장성이나 유지보수성을 고려했을 때, 메뉴는 변동 가능성이 큰 부분이므로 어플리케이션 단위에서 다루는 것이 적절하다고 생각해 다음과 같이 수정해주었다.
```java
public static MenuBoard initMenuBoard() {
    List<Menu> menus = Arrays.asList(
        new Menu("양송이수프", 6_000, Category.APPETIZER),
        new Menu("타파스", 5_500, Category.APPETIZER),
        new Menu("시저샐러드", 8_000, Category.APPETIZER),
        new Menu("티본스테이크", 55_000, Category.MAIN),
        new Menu("바비큐립", 54_000, Category.MAIN),
        new Menu("해산물파스타", 35_000, Category.MAIN),
        new Menu("크리스마스파스타", 25_000, Category.MAIN),
        new Menu("초코케이크", 15_000, Category.DESSERT),
        new Menu("아이스크림", 5_000, Category.DESSERT),
        new Menu("제로콜라", 3_000, Category.DRINK),
        new Menu("레드와인", 60_000, Category.DRINK),
        new Menu("샴페인", 25_000, Category.DRINK)
    );

    return new MenuBoard(menus);
}
```

### 생성자와 정적 팩토리 메서드

미션을 진행하며 정적 팩토리 메서드(Static Factory Method)라는 개념을 알게 되었다.  

정적 팩토리 메서드를 사용하면 생성 목적과 과정에 따라 생성자를 구분할 수 있으며, 생성자를 제한해 정해진 범위를 벗어나는 생성을 막을 수 있게 되는 등 여러 이점이 있다.

생성하기 전에 값을 검증하는 것과 같이 별도의 작업이 필요할 때 정적 팩토리 메서드를 사용해야 하는데 기존의 코드에서는 별도의 로직이 없어도 정적 팩토리 메서드에서 단순히 생성자를 호출하는 식으로 작성된 부분이 있었다.

리팩토링을 수행하며 이런 부분은 과감히 삭제하고, Orders의 경우처럼 생성 전 검증이 필요한 경우나 BenefitManager와 같이 외부에서 날짜만을 매개변수로 받아 생성하고 싶은 경우에만 정적 팩토리 메서드를 활용하는 방식으로 수정했다.

이 부분은 추후 개선사항이기도 해, 보다 심도있게 공부해본 뒤 보다 적절한 방식으로 적용할 예정이다.

### 전략 패턴

본 프로그램에서는 여러 가지 할인 정책을 다루고 있다.

현재 코드는 Discount enum을 생성해 각 할인별로 할인 내용, 할인 금액, 추가 할인 금액(크리스마스의 할인에만 해당하는 필드), 할인을 위한 최소 주문 금액을 필드로 가질 수 있게 했다. 
할인 로직 역시 Discount 내부에서 구현하고자 하였으나 각 할인별로 할인 방식이나 필요한 매개 변수가 상이해 (평일/주말 할인의 경우 특정 카테고리의 메뉴 주문 수량이 필요하다) 어려움이 있다고 판단했고, DiscountPolicy에서 할인 로직을 다루는 방식으로 구현되어 있다.

총주문금액에서 혜택 내역을 차감하는 '할인'이라는 공통 속성을 추상화하여 보다 효과적으로 관리할 수 있지 않을까? 라는 생각에 전략 패턴을 찾아보게 되었고 적용하고자 했으나 
시간 관계상 적용해보지 못했다. 우선 제출 기한 전까지 시도해보고, 추후에라도 개선하고자 한다!  

---
## 🛠️ Develop

- [ ] 정적 팩토리 메서드
- [ ] 할인 정책 전략 패턴 활용

--- 
감사합니다 🙇‍